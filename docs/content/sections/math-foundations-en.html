<!-- PhD-Level Mathematical Foundations for Multi-Agent System -->

<style>
    .theorem-box {
        background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
        border: 2px solid #0284c7;
        border-radius: 1rem;
        padding: 2rem;
        margin: 2rem 0;
    }
    .theorem-title {
        color: #0c4a6e;
        font-weight: 600;
        margin-bottom: 1.5rem;
        font-size: 1.1rem;
    }
    .proof-box {
        background: #f0fdf4;
        border-radius: 0.5rem;
        padding: 1rem;
        font-style: italic;
        margin-top: 1rem;
    }
    .definition-box {
        background: white;
        border-radius: 0.5rem;
        padding: 1.5rem;
        margin: 1.5rem 0;
        font-family: 'Courier New', monospace;
        font-size: 0.95rem;
    }
    .math-formula {
        text-align: center;
        margin: 1.5rem 0;
        font-size: 1.1rem;
        font-family: 'Times New Roman', serif;
    }
    .optimization-box {
        background: linear-gradient(135deg, #f0fdf4, #dcfce7);
        border: 2px solid #16a34a;
        border-radius: 1rem;
        padding: 2rem;
        margin: 2rem 0;
    }
    .complexity-box {
        background: linear-gradient(135deg, #fef3c7, #fde68a);
        border: 2px solid #f59e0b;
        border-radius: 1rem;
        padding: 2rem;
        margin: 2rem 0;
    }
</style>

<!-- Main Title -->
<h3 style="font-size: 1.25rem; font-weight: 600; color: var(--text-primary); margin: 3rem 0 1.5rem 0;">
    📐 Mathematical Foundations and Theoretical Formalisms
</h3>

<!-- Formal System Definition -->
<div class="theorem-box">
    <h4 class="theorem-title">Definition 1: Heterogeneous Multi-Agent System for Public Transparency</h4>
    <div class="definition-box">
        <p><strong>Formal Definition:</strong> Let Ξ = ⟨A, E, S, O, T, Π, Φ, Ψ⟩ be a multi-agent system where:</p>
        <ul style="list-style: none; margin: 1rem 0; line-height: 1.8;">
            <li>• <strong>A = {a₁, a₂, ..., a₁₇}</strong> is the finite set of heterogeneous agents</li>
            <li>• <strong>E ⊆ A × A</strong> is the set of communication channels (directed graph)</li>
            <li>• <strong>S = S₁ × S₂ × ... × S₁₇</strong> is the global state space of the system</li>
            <li>• <strong>O = ⋃ᵢ₌₁¹⁷ Oᵢ</strong> is the partial observation space</li>
            <li>• <strong>T: S × A × Π → Δ(S)</strong> is the stochastic transition function</li>
            <li>• <strong>Π = ⋃ᵢ₌₁¹⁷ Πᵢ</strong> is the joint action space</li>
            <li>• <strong>Φ: S → ℝⁿ</strong> is the state feature function</li>
            <li>• <strong>Ψ: O × H → Π</strong> is the decision policy with memory H</li>
        </ul>
        
        <p style="margin-top: 1.5rem;"><strong>Fundamental Properties:</strong></p>
        <div style="margin: 1rem 0; line-height: 1.6;">
            <p><strong>1. Partial Observability:</strong> ∀aᵢ ∈ A, ∃ηᵢ: S → Oᵢ such that aᵢ observes only ηᵢ(s)</p>
            <p><strong>2. Asynchronous Communication:</strong> Messages m ∈ M are transmitted with delay δ ~ Exp(λ)</p>
            <p><strong>3. Heterogeneity:</strong> ∀i ≠ j, Πᵢ ∩ Πⱼ = ∅ (specialized and disjoint actions)</p>
        </div>
    </div>
</div>

<!-- Convergence Theorem -->
<div class="theorem-box">
    <h4 class="theorem-title">Theorem 1: Asymptotic Convergence with Limited Communication</h4>
    <div class="definition-box">
        <p><strong>Statement:</strong> Consider the distributed consensus protocol in the Cidadão.AI system:</p>
        <div class="math-formula">
            x<sub>i</sub>(t+1) = w<sub>ii</sub>x<sub>i</sub>(t) + Σ<sub>j∈N<sub>i</sub>(t)</sub> w<sub>ij</sub>(t)x<sub>j</sub>(t) + ε<sub>i</sub>(t)
        </div>
        <p>where N<sub>i</sub>(t) is the active neighborhood at time t, w<sub>ij</sub>(t) are adaptive weights and ε<sub>i</sub>(t) ~ 𝒩(0, σ²<sub>i</sub>).</p>
        
        <p style="margin-top: 1.5rem;"><strong>Necessary and Sufficient Conditions:</strong></p>
        <div style="margin: 1rem 0; line-height: 1.8;">
            <p><strong>C1. Temporal Connectivity:</strong> The union graph G<sub>∞</sub> = ⋃<sub>k=0</sub><sup>∞</sup> G(kT, (k+1)T) is strongly connected</p>
            <p><strong>C2. Stochastic Balance:</strong> E[W(t)] is doubly stochastic almost surely</p>
            <p><strong>C3. Noise Limitation:</strong> ‖ε<sub>i</sub>(t)‖ ≤ ε̄ < ∞ ∀i,t with probability 1</p>
        </div>
        
        <p style="margin-top: 1.5rem;"><strong>Conclusion:</strong> Under conditions C1-C3, ∃ x* ∈ ℝᵈ such that:</p>
        <div class="math-formula">
            lim<sub>t→∞</sub> E[‖x<sub>i</sub>(t) - x*‖²] ≤ κσ²/μ
        </div>
        <p>where κ is the condition number of the communication graph and μ > 0 is the spectral gap.</p>
    </div>
    <div class="proof-box">
        <p><strong>Proof Sketch:</strong> Using the Lyapunov function V(t) = Σᵢ‖xᵢ(t) - x̄(t)‖² and applying the Robbins-Monro convergence lemma with Novikov conditions, we demonstrate that the system converges almost surely to consensus with exponential rate under bounded noise.</p>
    </div>
</div>

<!-- Optimality Theorem -->
<div class="optimization-box">
    <h4 style="color: #14532d; margin-bottom: 1.5rem; font-weight: 600;">Theorem 2: Multi-Agent Allocation Optimality under Uncertainty</h4>
    <div class="definition-box">
        <p><strong>Stochastic Optimization Problem:</strong></p>
        <div style="margin: 1.5rem 0; line-height: 1.8;">
            <div class="math-formula">min<sub>x∈X</sub> 𝔼[f(x,ξ)] = ∫<sub>Ξ</sub> f(x,ξ)P(dξ)</div>
            <p style="margin-top: 0.5rem;">subject to:</p>
            <div style="margin-left: 2rem;">
                <p>g<sub>i</sub>(x) ≤ 0, i = 1,...,m (capacity constraints)</p>
                <p>h<sub>j</sub>(x) = 0, j = 1,...,p (balance constraints)</p>
                <p>x ∈ X ⊆ ℝⁿ (convex and compact feasible set)</p>
            </div>
        </div>
        
        <p><strong>Augmented Lagrangian Formulation:</strong></p>
        <div class="math-formula">
            L<sub>ρ</sub>(x,λ,μ) = 𝔼[f(x,ξ)] + Σᵢλᵢgᵢ(x) + Σⱼμⱼhⱼ(x) + (ρ/2)‖c(x)‖²
        </div>
        
        <p style="margin-top: 1.5rem;"><strong>Distributed ADMM Algorithm for Multi-Agent System:</strong></p>
        <div style="margin: 1rem 0; background: #f8fafc; padding: 1rem; border-radius: 0.5rem;">
            <p><strong>Step 1:</strong> x<sup>(k+1)</sup> = argmin<sub>x</sub> L<sub>ρ</sub>(x, λ<sup>k</sup>, μ<sup>k</sup>)</p>
            <p><strong>Step 2:</strong> λᵢ<sup>(k+1)</sup> = max(0, λᵢ<sup>k</sup> + ρgᵢ(x<sup>(k+1)</sup>))</p>
            <p><strong>Step 3:</strong> μⱼ<sup>(k+1)</sup> = μⱼ<sup>k</sup> + ρhⱼ(x<sup>(k+1)</sup>)</p>
        </div>
        
        <p style="margin-top: 1.5rem;"><strong>Guaranteed Convergence Rate:</strong></p>
        <ul style="margin-left: 1.5rem; line-height: 1.6;">
            <li>• <strong>Convex Case:</strong> O(1/√k) for general problem</li>
            <li>• <strong>Strongly Convex Case:</strong> O(ρᵏ) with 0 < ρ < 1</li>
            <li>• <strong>Smooth Case:</strong> O(1/k) with Lipschitz gradient</li>
        </ul>
    </div>
</div>

<!-- Computational Complexity -->
<div class="complexity-box">
    <h4 style="color: #78350f; margin-bottom: 1.5rem; font-weight: 600;">Theorem 3: Computational Complexity of the System</h4>
    <div class="definition-box">
        <p><strong>Time Complexity per Iteration:</strong></p>
        <div class="math-formula">
            T(n,m,d) = O(n²d + nm + d³)
        </div>
        <p>where n = |A| (number of agents), m = number of constraints, d = state space dimensionality.</p>
        
        <p style="margin-top: 1.5rem;"><strong>Memory Complexity:</strong></p>
        <div class="math-formula">
            M(n,d,h) = O(nd² + nh + d²)
        </div>
        <p>where h is the memory horizon for history-based policies.</p>
        
        <p style="margin-top: 1.5rem;"><strong>Communication Complexity:</strong></p>
        <div style="margin: 1rem 0; line-height: 1.6;">
            <p><strong>• Bits per round:</strong> O(nd log(1/ε)) for precision ε</p>
            <p><strong>• Rounds to convergence:</strong> O(log(1/δ)/μ) with probability 1-δ</p>
            <p><strong>• Total bandwidth:</strong> O(n²d log(1/ε) log(1/δ)/μ)</p>
        </div>
    </div>
</div>

<!-- Performance Metrics -->
<h4 style="color: var(--text-primary); margin: 2rem 0 1rem 0; font-weight: 600;">📊 Theoretical Performance Metrics</h4>

<div style="display: grid; gap: 1.5rem; margin: 2rem 0;">
    <div style="background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: 0.5rem; padding: 1.5rem;">
        <h5 style="color: var(--text-accent); margin-bottom: 0.5rem;">Consensus Latency</h5>
        <p>Expected convergence time: <strong>E[T<sub>consensus</sub>] ≤ (log n)/μ + O(σ²/μ²)</strong></p>
    </div>
    
    <div style="background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: 0.5rem; padding: 1.5rem;">
        <h5 style="color: var(--text-accent); margin-bottom: 0.5rem;">Detection Accuracy</h5>
        <p>Correct detection probability: <strong>P(detection) ≥ 1 - exp(-nμt/2)</strong></p>
    </div>
    
    <div style="background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: 0.5rem; padding: 1.5rem;">
        <h5 style="color: var(--text-accent); margin-bottom: 0.5rem;">Scalability</h5>
        <p>Supports up to <strong>n = O(10³)</strong> agents with graceful O(log n) degradation</p>
    </div>
</div>

<!-- Application in Transparency Context -->
<div style="background: linear-gradient(135deg, #fef2f2, #fee2e2); border: 2px solid #ef4444; border-radius: 1rem; padding: 2rem; margin: 2rem 0;">
    <h4 style="color: #991b1b; margin-bottom: 1.5rem;">Application: Distributed Anomaly Detection</h4>
    <div class="definition-box">
        <p><strong>Problem Modeling:</strong></p>
        <ul style="margin: 1rem 0; line-height: 1.8;">
            <li>• <strong>State x<sub>i</sub>:</strong> Feature vector extracted from contracts/biddings</li>
            <li>• <strong>Observation y<sub>i</sub>:</strong> Locally computed anomaly score</li>
            <li>• <strong>Consensus z*:</strong> Global decision on irregularity existence</li>
            <li>• <strong>Constraints:</strong> Privacy, latency < 1s, accuracy > 95%</li>
        </ul>
        
        <p><strong>System Guarantees:</strong></p>
        <div class="math-formula">
            P(|z<sub>i</sub>(T) - z*| < ε) ≥ 1 - δ, ∀i ∈ A
        </div>
        <p>where T = O(log(1/δ)/μ) is the convergence time and ε > 0 is the desired tolerance.</p>
    </div>
</div>