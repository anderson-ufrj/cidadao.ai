<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API e Integra√ß√£o - Cidad√£o.AI</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß API e Integra√ß√£o - Cidad√£o.AI</h1>
            <div class="language-switch">
                <a href="api_en.html" class="lang-link">üá∫üá∏ English</a>
            </div>
        </div>

        <nav class="breadcrumb">
            <a href="index.html">üìö Documenta√ß√£o</a> > <span>üîß API e Integra√ß√£o</span>
        </nav>

        <main>
            <h2>üöÄ Vis√£o Geral da API</h2>
            <p>A API REST do Cidad√£o.AI oferece acesso completo ao sistema de an√°lise de transpar√™ncia governamental. Desenvolvida com FastAPI, oferece documenta√ß√£o autom√°tica, valida√ß√£o de dados e performance otimizada.</p>

            <div class="alert info">
                <strong>üåê Base URL:</strong> <code>https://api.cidadao.ai/api/v1</code><br>
                <strong>üìÑ Documenta√ß√£o Interativa:</strong> <code>/docs</code> (Swagger UI)<br>
                <strong>‚ö° Performance:</strong> &lt; 200ms para endpoints s√≠ncronos
            </div>

            <h2>üîê Autentica√ß√£o</h2>
            <p>A API suporta m√∫ltiplos m√©todos de autentica√ß√£o:</p>

            <h3>JWT Token</h3>
            <pre><code>Authorization: Bearer &lt;jwt_token&gt;</code></pre>

            <h3>API Key</h3>
            <pre><code>X-API-Key: &lt;sua_api_key&gt;</code></pre>

            <h3>Exemplo de Autentica√ß√£o</h3>
            <pre><code>curl -X POST "https://api.cidadao.ai/auth/login" \
     -H "Content-Type: application/json" \
     -d '{"username": "usuario", "password": "senha"}'</code></pre>

            <h2>üìä Endpoints Principais</h2>

            <h3>üè• Health & Status</h3>
            <table>
                <thead>
                    <tr>
                        <th>Endpoint</th>
                        <th>M√©todo</th>
                        <th>Descri√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>/health</code></td>
                        <td>GET</td>
                        <td>Verifica√ß√£o b√°sica de sa√∫de</td>
                    </tr>
                    <tr>
                        <td><code>/health/detailed</code></td>
                        <td>GET</td>
                        <td>Status detalhado do sistema</td>
                    </tr>
                    <tr>
                        <td><code>/health/ready</code></td>
                        <td>GET</td>
                        <td>Prontid√£o para Kubernetes</td>
                    </tr>
                </tbody>
            </table>

            <h3>üîç Investiga√ß√µes</h3>
            <table>
                <thead>
                    <tr>
                        <th>Endpoint</th>
                        <th>M√©todo</th>
                        <th>Descri√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>/investigations</code></td>
                        <td>POST</td>
                        <td>Iniciar nova investiga√ß√£o</td>
                    </tr>
                    <tr>
                        <td><code>/investigations/{id}/stream</code></td>
                        <td>GET</td>
                        <td>Stream em tempo real da investiga√ß√£o</td>
                    </tr>
                    <tr>
                        <td><code>/investigations/{id}</code></td>
                        <td>GET</td>
                        <td>Obter resultados completos</td>
                    </tr>
                    <tr>
                        <td><code>/investigations</code></td>
                        <td>GET</td>
                        <td>Listar investiga√ß√µes do usu√°rio</td>
                    </tr>
                </tbody>
            </table>

            <h3>üìà An√°lises</h3>
            <table>
                <thead>
                    <tr>
                        <th>Endpoint</th>
                        <th>M√©todo</th>
                        <th>Descri√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>/analysis/spending-trends</code></td>
                        <td>POST</td>
                        <td>An√°lise de tend√™ncias de gastos</td>
                    </tr>
                    <tr>
                        <td><code>/analysis/vendor-patterns</code></td>
                        <td>POST</td>
                        <td>Padr√µes de fornecedores</td>
                    </tr>
                    <tr>
                        <td><code>/analysis/correlations</code></td>
                        <td>POST</td>
                        <td>An√°lise de correla√ß√µes</td>
                    </tr>
                    <tr>
                        <td><code>/analysis/organizational</code></td>
                        <td>POST</td>
                        <td>Comportamento organizacional</td>
                    </tr>
                </tbody>
            </table>

            <h3>üìÑ Relat√≥rios</h3>
            <table>
                <thead>
                    <tr>
                        <th>Endpoint</th>
                        <th>M√©todo</th>
                        <th>Descri√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>/reports/executive</code></td>
                        <td>POST</td>
                        <td>Relat√≥rio executivo</td>
                    </tr>
                    <tr>
                        <td><code>/reports/detailed</code></td>
                        <td>POST</td>
                        <td>Relat√≥rio detalhado</td>
                    </tr>
                    <tr>
                        <td><code>/reports/investigation/{id}</code></td>
                        <td>GET</td>
                        <td>Relat√≥rio de investiga√ß√£o</td>
                    </tr>
                    <tr>
                        <td><code>/reports/{id}/download</code></td>
                        <td>GET</td>
                        <td>Download do relat√≥rio</td>
                    </tr>
                </tbody>
            </table>

            <h2>üåä Streaming em Tempo Real</h2>
            <p>A API oferece endpoints de streaming usando Server-Sent Events (SSE) para atualiza√ß√µes em tempo real:</p>

            <h3>Exemplo de Streaming de Investiga√ß√£o</h3>
            <pre><code>const eventSource = new EventSource('/api/v1/investigations/123/stream');

eventSource.onmessage = function(event) {
    const data = JSON.parse(event.data);
    console.log('Progresso:', data.progress);
    console.log('Status:', data.status);
    console.log('Resultados:', data.results);
};

eventSource.addEventListener('complete', function(event) {
    console.log('Investiga√ß√£o conclu√≠da!');
    eventSource.close();
});</code></pre>

            <h2>üìù Exemplos de Uso</h2>

            <h3>Iniciar Investiga√ß√£o</h3>
            <pre><code>POST /api/v1/investigations
Content-Type: application/json
Authorization: Bearer &lt;token&gt;

{
    "query": "contratos suspeitos do minist√©rio da sa√∫de em 2024",
    "filters": {
        "ano": 2024,
        "orgao": "26000",
        "valor_inicial": 1000000
    },
    "options": {
        "anomaly_threshold": 0.8,
        "include_explanations": true,
        "output_format": "markdown"
    }
}</code></pre>

            <h3>Resposta de Investiga√ß√£o</h3>
            <pre><code>{
    "investigation_id": "inv_abc123",
    "status": "started",
    "query": "contratos suspeitos do minist√©rio da sa√∫de em 2024",
    "created_at": "2024-01-15T10:30:00Z",
    "estimated_duration": "2-5 minutos",
    "stream_url": "/api/v1/investigations/inv_abc123/stream"
}</code></pre>

            <h3>An√°lise de Padr√µes</h3>
            <pre><code>POST /api/v1/analysis/vendor-patterns
Content-Type: application/json
Authorization: Bearer &lt;token&gt;

{
    "data_source": "contracts",
    "filters": {
        "ano": 2024,
        "orgao": "26000"
    },
    "analysis_type": "frequency_patterns",
    "include_explanations": true
}</code></pre>

            <h2>‚ö° Recursos Avan√ßados</h2>

            <h3>üîÑ Rate Limiting</h3>
            <p>A API implementa limita√ß√£o inteligente de taxa:</p>
            <ul>
                <li><strong>Usu√°rios autenticados:</strong> 100 requisi√ß√µes/minuto</li>
                <li><strong>Usu√°rios premium:</strong> 500 requisi√ß√µes/minuto</li>
                <li><strong>Headers de resposta:</strong> <code>X-RateLimit-Remaining</code>, <code>X-RateLimit-Reset</code></li>
            </ul>

            <h3>üìä M√∫ltiplos Formatos</h3>
            <p>Suporte para m√∫ltiplos formatos de resposta:</p>
            <ul>
                <li><strong>JSON:</strong> Formato padr√£o para integra√ß√£o</li>
                <li><strong>Markdown:</strong> Para documenta√ß√£o e relat√≥rios</li>
                <li><strong>HTML:</strong> Para visualiza√ß√£o web</li>
                <li><strong>CSV/Excel:</strong> Para an√°lise de dados</li>
            </ul>

            <h3>üîç Filtros Avan√ßados</h3>
            <pre><code>{
    "filters": {
        "ano": 2024,
        "mes": [1, 2, 3],
        "orgao": ["26000", "20000"],
        "valor_inicial": 100000,
        "valor_final": 10000000,
        "modalidade": "pregao_eletronico",
        "situacao": "ativo",
        "cnpj_fornecedor": "12345678000199"
    }
}</code></pre>

            <h2>üîó Integra√ß√£o com Portal da Transpar√™ncia</h2>
            <p>A API integra-se automaticamente com o Portal da Transpar√™ncia:</p>

            <div class="api-info">
                <h3>‚ú® Recursos de Integra√ß√£o</h3>
                <ul>
                    <li><strong>Cache Inteligente:</strong> Reduz chamadas desnecess√°rias √† API governamental</li>
                    <li><strong>Retry Autom√°tico:</strong> Recupera√ß√£o autom√°tica de falhas tempor√°rias</li>
                    <li><strong>Rate Limiting:</strong> Respeita limites da API governamental</li>
                    <li><strong>Normaliza√ß√£o:</strong> Padroniza dados de diferentes fontes</li>
                    <li><strong>Valida√ß√£o:</strong> Verifica integridade dos dados recebidos</li>
                </ul>
            </div>

            <h2>üîß SDKs e Bibliotecas</h2>

            <h3>Python SDK</h3>
            <pre><code>from cidadao_ai import CidadaoAI

client = CidadaoAI(api_key="sua_api_key")

# Iniciar investiga√ß√£o
investigation = await client.investigate(
    "contratos suspeitos de emerg√™ncia",
    filters={"ano": 2024}
)

# Acompanhar progresso
async for update in investigation.stream():
    print(f"Progresso: {update.progress}%")
    
# Obter resultados
results = await investigation.get_results()</code></pre>

            <h3>JavaScript SDK</h3>
            <pre><code>import { CidadaoAI } from '@cidadao-ai/sdk';

const client = new CidadaoAI({ apiKey: 'sua_api_key' });

// Iniciar investiga√ß√£o
const investigation = await client.investigate({
    query: 'contratos suspeitos de emerg√™ncia',
    filters: { ano: 2024 }
});

// Streaming em tempo real
investigation.onUpdate((update) => {
    console.log(`Progresso: ${update.progress}%`);
});</code></pre>

            <h2>üìä Monitoramento e M√©tricas</h2>
            <p>A API oferece endpoints para monitoramento:</p>

            <table>
                <thead>
                    <tr>
                        <th>Endpoint</th>
                        <th>Descri√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>/metrics</code></td>
                        <td>M√©tricas Prometheus</td>
                    </tr>
                    <tr>
                        <td><code>/stats/usage</code></td>
                        <td>Estat√≠sticas de uso da API</td>
                    </tr>
                    <tr>
                        <td><code>/stats/performance</code></td>
                        <td>M√©tricas de performance</td>
                    </tr>
                </tbody>
            </table>

            <h2>üîí Seguran√ßa</h2>

            <div class="alert warning">
                <strong>‚ö†Ô∏è Importante:</strong> Nunca exponha suas chaves de API em c√≥digo cliente. Use sempre vari√°veis de ambiente ou servi√ßos de gest√£o de secrets.
            </div>

            <h3>Boas Pr√°ticas</h3>
            <ul>
                <li>‚úÖ Use HTTPS para todas as requisi√ß√µes</li>
                <li>‚úÖ Armazene tokens de forma segura</li>
                <li>‚úÖ Implemente timeout nas requisi√ß√µes</li>
                <li>‚úÖ Valide todas as respostas da API</li>
                <li>‚úÖ Use rate limiting do lado cliente</li>
                <li>‚úÖ Monitore logs de auditoria</li>
            </ul>

            <h2>üÜò Suporte e Troubleshooting</h2>

            <h3>C√≥digos de Erro Comuns</h3>
            <table>
                <thead>
                    <tr>
                        <th>C√≥digo</th>
                        <th>Descri√ß√£o</th>
                        <th>Solu√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>401</td>
                        <td>N√£o autorizado</td>
                        <td>Verifique token/API key</td>
                    </tr>
                    <tr>
                        <td>429</td>
                        <td>Rate limit excedido</td>
                        <td>Aguarde ou upgrade do plano</td>
                    </tr>
                    <tr>
                        <td>422</td>
                        <td>Dados inv√°lidos</td>
                        <td>Verifique formato dos dados</td>
                    </tr>
                    <tr>
                        <td>503</td>
                        <td>Servi√ßo indispon√≠vel</td>
                        <td>Tente novamente mais tarde</td>
                    </tr>
                </tbody>
            </table>

            <div class="alert info">
                <strong>üéØ Dica:</strong> Use a documenta√ß√£o interativa em <code>/docs</code> para testar endpoints diretamente no navegador.
            </div>
        </main>

        <footer>
            <nav class="doc-nav">
                <a href="overview_pt.html" class="nav-btn">‚¨ÖÔ∏è Vis√£o Geral</a>
                <a href="development_pt.html" class="nav-btn">Guia de Desenvolvimento ‚û°Ô∏è</a>
            </nav>
        </footer>
    </div>
</body>
</html>