<div class="section-header">
    <h2 class="section-title">
        üíª <span data-pt="Implementa√ß√£o T√©cnica" data-en="Technical Implementation">Implementa√ß√£o T√©cnica</span>
    </h2>
    <p class="section-description" data-pt="Detalhes t√©cnicos da implementa√ß√£o do sistema Cidad√£o.AI, incluindo arquitetura de microservi√ßos, tecnologias utilizadas e padr√µes de design." data-en="Technical details of the Cidad√£o.AI system implementation, including microservices architecture, technologies used, and design patterns.">
        Detalhes t√©cnicos da implementa√ß√£o do sistema Cidad√£o.AI, incluindo arquitetura de microservi√ßos, tecnologias utilizadas e padr√µes de design.
    </p>
</div>

<style>
    .tech-section {
        margin-bottom: 3rem;
        padding: 2rem;
        background-color: var(--bg-secondary);
        border-radius: 0.5rem;
        border: 1px solid var(--border);
    }
    
    .tech-section h3 {
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        font-size: 1.5rem;
        font-weight: 600;
        border-bottom: 2px solid var(--border-light);
        padding-bottom: 0.5rem;
    }
    
    .tech-stack {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin: 2rem 0;
    }
    
    .tech-item {
        background-color: var(--bg-primary);
        padding: 1.5rem;
        border-radius: 0.5rem;
        border: 1px solid var(--border);
        transition: all 0.2s;
    }
    
    .tech-item:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }
    
    .tech-item h4 {
        color: var(--text-accent);
        margin-bottom: 1rem;
        font-size: 1.125rem;
        font-weight: 600;
    }
    
    .tech-badge {
        display: inline-block;
        background-color: var(--bg-accent);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.875rem;
        font-weight: 500;
        margin: 0.25rem 0.25rem 0.25rem 0;
    }
    
    .architecture-diagram {
        background-color: var(--bg-primary);
        border: 1px solid var(--border);
        border-radius: 0.5rem;
        padding: 2rem;
        margin: 2rem 0;
        text-align: center;
    }
    
    .layer {
        background-color: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 1rem;
        margin: 0.5rem 0;
        position: relative;
    }
    
    .layer h4 {
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        font-weight: 600;
    }
    
    .layer-components {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 1rem;
    }
    
    .component {
        background-color: var(--bg-primary);
        border: 1px solid var(--border-light);
        border-radius: 0.25rem;
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        color: var(--text-secondary);
    }
    
    .database-schema {
        background-color: var(--bg-tertiary);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 1.5rem;
        margin: 1rem 0;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.875rem;
    }
    
    .deployment-flow {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 2rem 0;
    }
    
    .deployment-step {
        background-color: var(--bg-primary);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 1rem;
        text-align: center;
        position: relative;
    }
    
    .deployment-step::after {
        content: '‚Üí';
        position: absolute;
        right: -0.5rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-accent);
        font-weight: bold;
    }
    
    .deployment-step:last-child::after {
        display: none;
    }
    
    .monitoring-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
        margin: 2rem 0;
    }
    
    .metric-card {
        background-color: var(--bg-primary);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 1.5rem;
        text-align: center;
    }
    
    .metric-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--brazil-blue);
        margin-bottom: 0.5rem;
    }
    
    .metric-label {
        color: var(--text-secondary);
        font-size: 0.875rem;
    }
    
    .code-sample {
        background-color: var(--bg-tertiary);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        padding: 1rem;
        margin: 1rem 0;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.875rem;
        overflow-x: auto;
    }
    
    .feature-highlight {
        background: linear-gradient(135deg, var(--brazil-green), var(--brazil-blue));
        color: white;
        padding: 1.5rem;
        border-radius: 0.5rem;
        margin: 2rem 0;
    }
    
    .feature-highlight h4 {
        color: white;
        margin-bottom: 1rem;
    }
</style>

<!-- Technology Stack -->
<div class="tech-section">
    <h3>üõ†Ô∏è <span data-pt="Stack Tecnol√≥gico" data-en="Technology Stack">Stack Tecnol√≥gico</span></h3>
    
    <div class="tech-stack">
        <div class="tech-item">
            <h4>üñ•Ô∏è <span data-pt="Backend" data-en="Backend">Backend</span></h4>
            <div class="tech-badge">Python 3.11+</div>
            <div class="tech-badge">FastAPI</div>
            <div class="tech-badge">SQLAlchemy</div>
            <div class="tech-badge">Pydantic</div>
            <div class="tech-badge">Celery</div>
            <div class="tech-badge">Redis</div>
        </div>
        
        <div class="tech-item">
            <h4>ü§ñ <span data-pt="Intelig√™ncia Artificial" data-en="Artificial Intelligence">Intelig√™ncia Artificial</span></h4>
            <div class="tech-badge">Transformers</div>
            <div class="tech-badge">LangChain</div>
            <div class="tech-badge">ChromaDB</div>
            <div class="tech-badge">FAISS</div>
            <div class="tech-badge">Scikit-learn</div>
            <div class="tech-badge">SHAP</div>
        </div>
        
        <div class="tech-item">
            <h4>üóÑÔ∏è <span data-pt="Banco de Dados" data-en="Database">Banco de Dados</span></h4>
            <div class="tech-badge">PostgreSQL</div>
            <div class="tech-badge">Redis</div>
            <div class="tech-badge">MinIO</div>
            <div class="tech-badge">Elasticsearch</div>
        </div>
        
        <div class="tech-item">
            <h4>üöÄ <span data-pt="DevOps" data-en="DevOps">DevOps</span></h4>
            <div class="tech-badge">Docker</div>
            <div class="tech-badge">Kubernetes</div>
            <div class="tech-badge">Nginx</div>
            <div class="tech-badge">GitHub Actions</div>
            <div class="tech-badge">Prometheus</div>
            <div class="tech-badge">Grafana</div>
        </div>
    </div>
</div>

<!-- System Architecture -->
<div class="tech-section">
    <h3>üèóÔ∏è <span data-pt="Arquitetura do Sistema" data-en="System Architecture">Arquitetura do Sistema</span></h3>
    
    <div class="architecture-diagram">
        <div class="layer">
            <h4>üåê <span data-pt="Camada de Apresenta√ß√£o" data-en="Presentation Layer">Camada de Apresenta√ß√£o</span></h4>
            <div class="layer-components">
                <div class="component">Gradio UI</div>
                <div class="component">Streamlit Dashboard</div>
                <div class="component">REST API</div>
                <div class="component">WebSocket</div>
            </div>
        </div>
        
        <div class="layer">
            <h4>üîß <span data-pt="Camada de Servi√ßos" data-en="Service Layer">Camada de Servi√ßos</span></h4>
            <div class="layer-components">
                <div class="component">Investigation Service</div>
                <div class="component">Analysis Service</div>
                <div class="component">Report Service</div>
                <div class="component">Notification Service</div>
            </div>
        </div>
        
        <div class="layer">
            <h4>ü§ñ <span data-pt="Camada de Agentes" data-en="Agent Layer">Camada de Agentes</span></h4>
            <div class="layer-components">
                <div class="component">MasterAgent</div>
                <div class="component">InvestigatorAgent</div>
                <div class="component">AnalystAgent</div>
                <div class="component">ReporterAgent</div>
                <div class="component">MemoryAgent</div>
            </div>
        </div>
        
        <div class="layer">
            <h4>üß† <span data-pt="Camada de ML/AI" data-en="ML/AI Layer">Camada de ML/AI</span></h4>
            <div class="layer-components">
                <div class="component">Cidad√£oGPT</div>
                <div class="component">Anomaly Detection</div>
                <div class="component">Pattern Analysis</div>
                <div class="component">Semantic Search</div>
            </div>
        </div>
        
        <div class="layer">
            <h4>üóÑÔ∏è <span data-pt="Camada de Dados" data-en="Data Layer">Camada de Dados</span></h4>
            <div class="layer-components">
                <div class="component">PostgreSQL</div>
                <div class="component">Redis Cache</div>
                <div class="component">Vector DB</div>
                <div class="component">MinIO Storage</div>
            </div>
        </div>
    </div>
</div>

<!-- Multi-Agent Implementation -->
<div class="tech-section">
    <h3>ü§ñ <span data-pt="Implementa√ß√£o Multi-Agente" data-en="Multi-Agent Implementation">Implementa√ß√£o Multi-Agente</span></h3>
    
    <div class="feature-highlight">
        <h4>üîÑ <span data-pt="Orquestra√ß√£o de Agentes" data-en="Agent Orchestration">Orquestra√ß√£o de Agentes</span></h4>
        <p data-pt="Sistema distribu√≠do com comunica√ß√£o ass√≠ncrona baseada em message passing e coordination protocols." data-en="Distributed system with asynchronous communication based on message passing and coordination protocols.">
            Sistema distribu√≠do com comunica√ß√£o ass√≠ncrona baseada em message passing e coordination protocols.
        </p>
    </div>
    
    <div class="code-sample">
# Agent Communication Protocol
class AgentMessage:
    def __init__(self, sender: str, receiver: str, content: dict, priority: int = 0):
        self.sender = sender
        self.receiver = receiver
        self.content = content
        self.priority = priority
        self.timestamp = datetime.utcnow()

# Master Agent Coordination
class MasterAgent:
    async def coordinate_investigation(self, query: str) -> InvestigationResult:
        # Decompose query into subtasks
        subtasks = await self.decompose_query(query)
        
        # Assign tasks to specialized agents
        results = await asyncio.gather(
            self.investigator.analyze_anomalies(subtasks.anomaly_task),
            self.analyst.analyze_patterns(subtasks.pattern_task),
            self.reporter.generate_report(subtasks.report_task)
        )
        
        return self.synthesize_results(results)
    </div>
</div>

<!-- Database Schema -->
<div class="tech-section">
    <h3>üóÑÔ∏è <span data-pt="Schema de Banco de Dados" data-en="Database Schema">Schema de Banco de Dados</span></h3>
    
    <div class="database-schema">
investigations (
    id UUID PRIMARY KEY,
    query TEXT NOT NULL,
    status investigation_status NOT NULL,
    priority priority_level DEFAULT 'medium',
    created_at TIMESTAMP DEFAULT NOW(),
    completed_at TIMESTAMP,
    results JSONB,
    metadata JSONB
);

documents (
    id UUID PRIMARY KEY,
    investigation_id UUID REFERENCES investigations(id),
    document_type document_type NOT NULL,
    content TEXT NOT NULL,
    source_url TEXT,
    processed_at TIMESTAMP DEFAULT NOW(),
    anomaly_score FLOAT,
    risk_level risk_level
);

anomalies (
    id UUID PRIMARY KEY,
    document_id UUID REFERENCES documents(id),
    anomaly_type anomaly_type NOT NULL,
    confidence FLOAT NOT NULL,
    description TEXT,
    severity severity_level NOT NULL,
    detected_at TIMESTAMP DEFAULT NOW()
);

agents_performance (
    id UUID PRIMARY KEY,
    agent_name VARCHAR(100) NOT NULL,
    task_type VARCHAR(100) NOT NULL,
    processing_time INTERVAL NOT NULL,
    success_rate FLOAT NOT NULL,
    recorded_at TIMESTAMP DEFAULT NOW()
);
    </div>
</div>

<!-- Deployment Pipeline -->
<div class="tech-section">
    <h3>üöÄ <span data-pt="Pipeline de Deploy" data-en="Deployment Pipeline">Pipeline de Deploy</span></h3>
    
    <div class="deployment-flow">
        <div class="deployment-step">
            <h4>üîß <span data-pt="Build" data-en="Build">Build</span></h4>
            <p data-pt="Docker images" data-en="Docker images">Docker images</p>
        </div>
        
        <div class="deployment-step">
            <h4>üß™ <span data-pt="Test" data-en="Test">Test</span></h4>
            <p data-pt="Unit & Integration" data-en="Unit & Integration">Unit & Integration</p>
        </div>
        
        <div class="deployment-step">
            <h4>üîç <span data-pt="Security" data-en="Security">Security</span></h4>
            <p data-pt="Vulnerability scan" data-en="Vulnerability scan">Vulnerability scan</p>
        </div>
        
        <div class="deployment-step">
            <h4>üì¶ <span data-pt="Deploy" data-en="Deploy">Deploy</span></h4>
            <p data-pt="Kubernetes cluster" data-en="Kubernetes cluster">Kubernetes cluster</p>
        </div>
        
        <div class="deployment-step">
            <h4>üìä <span data-pt="Monitor" data-en="Monitor">Monitor</span></h4>
            <p data-pt="Health checks" data-en="Health checks">Health checks</p>
        </div>
    </div>
    
    <div class="code-sample">
# Kubernetes Deployment Configuration
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cidadao-ai-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: cidadao-ai-api
  template:
    metadata:
      labels:
        app: cidadao-ai-api
    spec:
      containers:
      - name: api
        image: cidadao-ai/api:latest
        ports:
        - containerPort: 8000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
        resources:
          requests:
            memory: "1Gi"
            cpu: "500m"
          limits:
            memory: "2Gi"
            cpu: "1000m"
    </div>
</div>

<!-- Performance Monitoring -->
<div class="tech-section">
    <h3>üìä <span data-pt="Monitoramento de Performance" data-en="Performance Monitoring">Monitoramento de Performance</span></h3>
    
    <div class="monitoring-metrics">
        <div class="metric-card">
            <div class="metric-value">< 200ms</div>
            <div class="metric-label" data-pt="Tempo de Resposta API" data-en="API Response Time">Tempo de Resposta API</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-value">99.9%</div>
            <div class="metric-label" data-pt="Disponibilidade" data-en="Availability">Disponibilidade</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-value">1000+</div>
            <div class="metric-label" data-pt="Req/min" data-en="Req/min">Req/min</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-value">85%</div>
            <div class="metric-label" data-pt="Cache Hit Rate" data-en="Cache Hit Rate">Cache Hit Rate</div>
        </div>
    </div>
    
    <div class="code-sample">
# Prometheus Metrics Configuration
from prometheus_client import Counter, Histogram, Gauge

# Request metrics
REQUEST_COUNT = Counter('requests_total', 'Total requests', ['method', 'endpoint'])
REQUEST_DURATION = Histogram('request_duration_seconds', 'Request duration')
ACTIVE_INVESTIGATIONS = Gauge('active_investigations', 'Number of active investigations')

# Agent performance metrics
AGENT_TASK_DURATION = Histogram('agent_task_duration_seconds', 'Agent task duration', ['agent_name'])
ANOMALY_DETECTION_ACCURACY = Gauge('anomaly_detection_accuracy', 'Anomaly detection accuracy')

# Database metrics
DB_CONNECTION_POOL = Gauge('db_connection_pool_size', 'Database connection pool size')
CACHE_HIT_RATE = Gauge('cache_hit_rate', 'Cache hit rate')
    </div>
</div>

<!-- Error Handling -->
<div class="tech-section">
    <h3>‚ö†Ô∏è <span data-pt="Tratamento de Erros" data-en="Error Handling">Tratamento de Erros</span></h3>
    
    <div class="code-sample">
# Custom Exception Hierarchy
class CidadaoAIException(Exception):
    """Base exception for Cidad√£o.AI system"""
    pass

class InvestigationError(CidadaoAIException):
    """Raised when investigation fails"""
    pass

class AgentCommunicationError(CidadaoAIException):
    """Raised when agent communication fails"""
    pass

class DataSourceError(CidadaoAIException):
    """Raised when data source is unavailable"""
    pass

# Circuit Breaker Pattern
class CircuitBreaker:
    def __init__(self, failure_threshold=5, recovery_timeout=60):
        self.failure_threshold = failure_threshold
        self.recovery_timeout = recovery_timeout
        self.failure_count = 0
        self.last_failure_time = None
        self.state = 'CLOSED'  # CLOSED, OPEN, HALF_OPEN
    
    async def call(self, func, *args, **kwargs):
        if self.state == 'OPEN':
            if time.time() - self.last_failure_time > self.recovery_timeout:
                self.state = 'HALF_OPEN'
            else:
                raise CircuitBreakerOpen()
        
        try:
            result = await func(*args, **kwargs)
            self.on_success()
            return result
        except Exception as e:
            self.on_failure()
            raise
    </div>
</div>

<!-- Next Section Preview -->
<div class="info-card">
    <h4>üîÆ <span data-pt="Pr√≥xima Se√ß√£o: Framework de Seguran√ßa" data-en="Next Section: Security Framework">Pr√≥xima Se√ß√£o: Framework de Seguran√ßa</span></h4>
    <p data-pt="A pr√≥xima se√ß√£o abordar√° os aspectos de seguran√ßa do sistema, incluindo autentica√ß√£o, autoriza√ß√£o, criptografia e conformidade com LGPD." data-en="The next section will cover system security aspects, including authentication, authorization, encryption, and LGPD compliance.">
        A pr√≥xima se√ß√£o abordar√° os aspectos de seguran√ßa do sistema, incluindo autentica√ß√£o, autoriza√ß√£o, criptografia e conformidade com LGPD.
    </p>
</div>